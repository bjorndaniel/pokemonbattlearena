<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Explorer</title>
    <!-- Include Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif;
            transition: background-color 0.3s ease;
        }

        .theme-transition {
            transition: all 0.3s ease;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    'sans': ['Helvetica', 'Arial', 'sans-serif'],
                },
                extend: {
                    colors: {
                        'pokemon-normal': '#A8A77A',
                        'pokemon-fire': '#EE8130',
                        'pokemon-water': '#6390F0',
                        'pokemon-grass': '#7AC74C',
                        'pokemon-electric': '#F7D02C',
                        'pokemon-ice': '#96D9D6',
                        'pokemon-fighting': '#C22E28',
                        'pokemon-poison': '#A33EA1',
                        'pokemon-ground': '#E2BF65',
                        'pokemon-flying': '#A98FF3',
                        'pokemon-psychic': '#F95587',
                        'pokemon-bug': '#A6B91A',
                        'pokemon-rock': '#B6A136',
                        'pokemon-ghost': '#735797',
                        'pokemon-dark': '#705746',
                        'pokemon-dragon': '#6F35FC',
                        'pokemon-steel': '#B7B7CE',
                        'pokemon-fairy': '#D685AD',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100 min-h-screen theme-transition" id="mainBody">
    <header id="mainHeader" class="bg-red-600 p-6 shadow-md theme-transition">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-white">Pokémon Explorer</h1>
            <div class="space-x-4">
                <a href="pokemon-battle.html"
                    class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-md text-white font-medium transition">
                    Battle Arena
                </a>
            </div>
        </div>
    </header>
    <main class="container mx-auto p-6">
        <div class="mb-6">
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div class="flex-1">
                    <label for="pokemonSearch" class="block text-sm font-medium text-gray-700 mb-1">Search
                        Pokémon</label>
                    <div class="flex">
                        <input type="text" id="pokemonSearch" name="pokemonSearch" placeholder="Enter name or ID"
                            class="px-4 py-2 border border-gray-300 rounded-l-md flex-1 focus:outline-none focus:ring-2 focus:ring-red-500">
                        <button id="searchBtn"
                            class="bg-red-600 text-white px-4 py-2 rounded-r-md hover:bg-red-700 transition">
                            Search
                        </button>
                    </div>
                </div>
                <div class="flex-1">
                    <label for="pokemonType" class="block text-sm font-medium text-gray-700 mb-1">Filter by Type</label>
                    <select id="pokemonType"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <option value="">Select Type</option>
                        <option value="normal">Normal</option>
                        <option value="fire">Fire</option>
                        <option value="water">Water</option>
                        <option value="grass">Grass</option>
                        <option value="electric">Electric</option>
                        <option value="ice">Ice</option>
                        <option value="fighting">Fighting</option>
                        <option value="poison">Poison</option>
                        <option value="ground">Ground</option>
                        <option value="flying">Flying</option>
                        <option value="psychic">Psychic</option>
                        <option value="bug">Bug</option>
                        <option value="rock">Rock</option>
                        <option value="ghost">Ghost</option>
                        <option value="dark">Dark</option>
                        <option value="dragon">Dragon</option>
                        <option value="steel">Steel</option>
                        <option value="fairy">Fairy</option>
                    </select>
                </div>
            </div>

            <div class="flex justify-between items-center">
                <button id="prevBtn"
                    class="bg-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 transition disabled:opacity-50">
                    Previous
                </button>
                <span id="pageInfo" class="text-gray-700">Page 1</span>
                <button id="nextBtn" class="bg-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 transition">
                    Next
                </button>
            </div>
        </div>

        <!-- Pokémon list container -->
        <div id="pokemonList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Pokémon cards will be inserted here via JavaScript -->
            <div class="flex items-center justify-center p-6">
                <p class="text-gray-500 italic">Loading Pokémon...</p>
            </div>
        </div>
    </main>
    <footer class="container mx-auto p-6 text-center mt-8">
        <a href="https://github.com/bjorndaniel/pokemonbattlearena"
            class="inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                    clip-rule="evenodd"></path>
            </svg>
            Checkout the code on Github
        </a>
    </footer>
    <!-- Import Pokémon API module -->
    <script type="module">
        import { getPokemons, getPokemonDetails, getPokemonSpecies, getPokemonsByType } from './pokemon.js';

        // Global variables
        let currentPage = 1;
        const PAGE_SIZE = 12;
        let totalPages = 0;
        let currentOffset = 0;
        let currentSearchTerm = '';
        let currentPokemonList = [];
        let currentTheme = 'default';

        // DOM elements
        const pokemonListEl = document.getElementById('pokemonList');
        const searchInput = document.getElementById('pokemonSearch');
        const searchBtn = document.getElementById('searchBtn');
        const typeSelect = document.getElementById('pokemonType');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfoEl = document.getElementById('pageInfo');
        const mainBody = document.getElementById('mainBody');
        const mainHeader = document.getElementById('mainHeader');

        // Theme color mapping
        const typeThemeColors = {
            'default': {
                header: 'bg-red-600',
                body: 'bg-gray-100',
                button: 'bg-red-600 hover:bg-red-700',
                accent: 'bg-red-600'
            },
            'normal': {
                header: 'bg-pokemon-normal',
                body: 'bg-gray-50',
                button: 'bg-pokemon-normal hover:bg-gray-500',
                accent: 'bg-pokemon-normal'
            },
            'fire': {
                header: 'bg-pokemon-fire',
                body: 'bg-amber-50',
                button: 'bg-pokemon-fire hover:bg-red-700',
                accent: 'bg-pokemon-fire'
            },
            'water': {
                header: 'bg-pokemon-water',
                body: 'bg-blue-50',
                button: 'bg-pokemon-water hover:bg-blue-700',
                accent: 'bg-pokemon-water'
            },
            'grass': {
                header: 'bg-pokemon-grass',
                body: 'bg-green-50',
                button: 'bg-pokemon-grass hover:bg-green-700',
                accent: 'bg-pokemon-grass'
            },
            'electric': {
                header: 'bg-pokemon-electric',
                body: 'bg-yellow-50',
                button: 'bg-pokemon-electric hover:bg-yellow-600',
                accent: 'bg-pokemon-electric'
            },
            'ice': {
                header: 'bg-pokemon-ice',
                body: 'bg-cyan-50',
                button: 'bg-pokemon-ice hover:bg-cyan-500',
                accent: 'bg-pokemon-ice'
            },
            'fighting': {
                header: 'bg-pokemon-fighting',
                body: 'bg-red-50',
                button: 'bg-pokemon-fighting hover:bg-red-800',
                accent: 'bg-pokemon-fighting'
            },
            'poison': {
                header: 'bg-pokemon-poison',
                body: 'bg-purple-50',
                button: 'bg-pokemon-poison hover:bg-purple-700',
                accent: 'bg-pokemon-poison'
            },
            'ground': {
                header: 'bg-pokemon-ground',
                body: 'bg-amber-50',
                button: 'bg-pokemon-ground hover:bg-yellow-700',
                accent: 'bg-pokemon-ground'
            },
            'flying': {
                header: 'bg-pokemon-flying',
                body: 'bg-indigo-50',
                button: 'bg-pokemon-flying hover:bg-indigo-500',
                accent: 'bg-pokemon-flying'
            },
            'psychic': {
                header: 'bg-pokemon-psychic',
                body: 'bg-pink-50',
                button: 'bg-pokemon-psychic hover:bg-pink-700',
                accent: 'bg-pokemon-psychic'
            },
            'bug': {
                header: 'bg-pokemon-bug',
                body: 'bg-lime-50',
                button: 'bg-pokemon-bug hover:bg-lime-700',
                accent: 'bg-pokemon-bug'
            },
            'rock': {
                header: 'bg-pokemon-rock',
                body: 'bg-amber-50',
                button: 'bg-pokemon-rock hover:bg-amber-700',
                accent: 'bg-pokemon-rock'
            },
            'ghost': {
                header: 'bg-pokemon-ghost',
                body: 'bg-indigo-50',
                button: 'bg-pokemon-ghost hover:bg-indigo-800',
                accent: 'bg-pokemon-ghost'
            },
            'dark': {
                header: 'bg-pokemon-dark',
                body: 'bg-neutral-100',
                button: 'bg-pokemon-dark hover:bg-neutral-800',
                accent: 'bg-pokemon-dark'
            },
            'dragon': {
                header: 'bg-pokemon-dragon',
                body: 'bg-violet-50',
                button: 'bg-pokemon-dragon hover:bg-violet-800',
                accent: 'bg-pokemon-dragon'
            },
            'steel': {
                header: 'bg-pokemon-steel',
                body: 'bg-slate-50',
                button: 'bg-pokemon-steel hover:bg-slate-500',
                accent: 'bg-pokemon-steel'
            },
            'fairy': {
                header: 'bg-pokemon-fairy',
                body: 'bg-pink-50',
                button: 'bg-pokemon-fairy hover:bg-pink-600',
                accent: 'bg-pokemon-fairy'
            }
        };

        // Initialize the app
        window.addEventListener('DOMContentLoaded', init);

        async function init() {
            // Load initial Pokémon list
            loadPokemonList();

            // Set up event listeners
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            typeSelect.addEventListener('change', handleTypeFilter);
            prevBtn.addEventListener('click', handlePrevPage);
            nextBtn.addEventListener('click', handleNextPage);
        }

        function setTheme(type) {
            // Reset previous theme
            if (currentTheme && typeThemeColors[currentTheme]) {
                mainHeader.classList.remove(typeThemeColors[currentTheme].header);
                mainBody.classList.remove(typeThemeColors[currentTheme].body);
                searchBtn.classList.remove(...typeThemeColors[currentTheme].button.split(' '));
            }

            // Set new theme
            const theme = typeThemeColors[type] || typeThemeColors['default'];
            currentTheme = type;

            mainHeader.classList.add(theme.header);
            mainBody.classList.add(theme.body);

            // Update button styles
            searchBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            searchBtn.classList.add(...theme.button.split(' '));

            // Update any modal or other themed elements
            document.querySelectorAll('.theme-accent').forEach(el => {
                // Remove all possible theme accents
                Object.values(typeThemeColors).forEach(colors => {
                    el.classList.remove(colors.accent);
                });
                // Add new theme accent
                el.classList.add(theme.accent);
            });
        }

        async function loadPokemonList() {
            try {
                pokemonListEl.innerHTML = '<div class="col-span-full text-center p-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"></div><p class="mt-2">Loading Pokémon...</p></div>';

                const data = await getPokemons(PAGE_SIZE, currentOffset);
                currentPokemonList = data.results;
                totalPages = Math.ceil(data.count / PAGE_SIZE);

                updatePageInfo();
                renderPokemonList(currentPokemonList);
            } catch (error) {
                pokemonListEl.innerHTML = `<div class="col-span-full text-center p-4 text-red-500">Error loading Pokémon: ${error.message}</div>`;
            }
        }

        async function handleSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (!searchTerm) {
                currentSearchTerm = '';
                currentOffset = 0;
                currentPage = 1;
                loadPokemonList();
                setTheme('default'); // Reset theme when clearing search
                return;
            }

            try {
                pokemonListEl.innerHTML = '<div class="col-span-full text-center p-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"></div><p class="mt-2">Searching...</p></div>';

                // Search for specific Pokémon
                const pokemon = await getPokemonDetails(searchTerm);
                currentPokemonList = [{ name: pokemon.name, url: `https://pokeapi.co/api/v2/pokemon/${pokemon.id}/` }];
                totalPages = 1;
                currentPage = 1;

                updatePageInfo();
                renderPokemonList(currentPokemonList);
            } catch (error) {
                pokemonListEl.innerHTML = `<div class="col-span-full text-center p-4 text-red-500">Pokémon not found: ${searchTerm}</div>`;
                currentPokemonList = [];
                totalPages = 0;
                updatePageInfo();
            }
        }

        async function handleTypeFilter() {
            const selectedType = typeSelect.value;
            if (!selectedType) {
                currentSearchTerm = '';
                currentOffset = 0;
                currentPage = 1;
                loadPokemonList();
                setTheme('default'); // Reset theme when no type is selected
                return;
            }

            try {
                // Set the theme based on selected type
                setTheme(selectedType);

                pokemonListEl.innerHTML = '<div class="col-span-full text-center p-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"></div><p class="mt-2">Filtering by type...</p></div>';

                const typeData = await getPokemonsByType(selectedType);
                const pokemonByType = typeData.pokemon.map(p => p.pokemon);

                // Handle pagination for type filtering
                const startIdx = (currentPage - 1) * PAGE_SIZE;
                const endIdx = startIdx + PAGE_SIZE;
                currentPokemonList = pokemonByType.slice(startIdx, endIdx);
                totalPages = Math.ceil(pokemonByType.length / PAGE_SIZE);

                updatePageInfo();
                renderPokemonList(currentPokemonList);
            } catch (error) {
                pokemonListEl.innerHTML = `<div class="col-span-full text-center p-4 text-red-500">Error filtering by type: ${error.message}</div>`;
            }
        }

        function handlePrevPage() {
            if (currentPage > 1) {
                currentPage--;
                currentOffset = (currentPage - 1) * PAGE_SIZE;
                if (typeSelect.value) {
                    handleTypeFilter();
                } else {
                    loadPokemonList();
                }
            }
        }

        function handleNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                currentOffset = (currentPage - 1) * PAGE_SIZE;
                if (typeSelect.value) {
                    handleTypeFilter();
                } else {
                    loadPokemonList();
                }
            }
        }

        function updatePageInfo() {
            pageInfoEl.textContent = `Page ${currentPage} of ${totalPages || 1}`;
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }

        async function renderPokemonList(pokemonList) {
            if (!pokemonList || pokemonList.length === 0) {
                pokemonListEl.innerHTML = '<div class="col-span-full text-center p-4">No Pokémon found</div>';
                return;
            }

            const pokemonDetailsPromises = pokemonList.map(pokemon => {
                const pokemonId = pokemon.url.split('/').filter(Boolean).pop();
                return getPokemonDetails(pokemonId);
            });

            try {
                const pokemonDetailsArray = await Promise.all(pokemonDetailsPromises);

                let html = '';
                pokemonDetailsArray.forEach(pokemon => {
                    const types = pokemon.types.map(type =>
                        `<span class="inline-block px-2 py-1 text-xs text-white bg-${getTypeColor(type.type.name)} rounded-full">${type.type.name}</span>`
                    ).join(' ');

                    html += `
                        <a href="pokemon-details.html?id=${pokemon.id}" class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition cursor-pointer pokemon-card">
                            <div class="p-4 text-center">
                                <img src="${pokemon.sprites.other['official-artwork'].front_default || pokemon.sprites.front_default}" 
                                     alt="${pokemon.name}" 
                                     class="w-32 h-32 mx-auto">
                                <h3 class="mt-2 text-lg font-semibold capitalize">${pokemon.name}</h3>
                                <p class="text-gray-500 text-sm">ID: #${pokemon.id.toString().padStart(3, '0')}</p>
                                <div class="mt-2 flex justify-center gap-1 flex-wrap">
                                    ${types}
                                </div>
                            </div>
                        </a>
                    `;
                });

                pokemonListEl.innerHTML = html;
            } catch (error) {
                pokemonListEl.innerHTML = `<div class="col-span-full text-center p-4 text-red-500">Error rendering Pokémon: ${error.message}</div>`;
            }
        }

        function getTypeColor(type) {
            // Updated to use the new pokemon-type colors
            return `pokemon-${type}`;
        }
    </script>
</body>

</html>